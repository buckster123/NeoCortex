#!/bin/bash
# Neo-Cortex CLI Launcher

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

# Find Python in priority order:
# 1. CORTEX_PYTHON env var (explicit override)
# 2. Local venv in neo-cortex directory
# 3. Active virtual environment
# 4. System python3
if [ -n "$CORTEX_PYTHON" ] && [ -f "$CORTEX_PYTHON" ]; then
    PYTHON="$CORTEX_PYTHON"
elif [ -f "$SCRIPT_DIR/venv/bin/python" ]; then
    PYTHON="$SCRIPT_DIR/venv/bin/python"
elif [ -n "$VIRTUAL_ENV" ] && [ -f "$VIRTUAL_ENV/bin/python" ]; then
    PYTHON="$VIRTUAL_ENV/bin/python"
else
    PYTHON="$(command -v python3 || command -v python)"
fi

if [ -z "$PYTHON" ]; then
    echo "Error: No Python found. Create a venv in $SCRIPT_DIR or set CORTEX_PYTHON." >&2
    exit 1
fi

cd "$SCRIPT_DIR"
exec "$PYTHON" -m service.cortex_cli "$@"
